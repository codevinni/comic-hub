<ui:composition template="templates/navigation-template.xhtml" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui">

	<f:metadata>
		<f:viewParam name="boxId" value="#{comicBean.boxId}" />
		<f:viewAction action="#{comicBean.loadBox}" />
	</f:metadata>

	<ui:define name="body">

		<h:panelGroup layout="block" style="display:flex; align-itens:center; margin-bottom: 20px;">
			<p:button icon="pi pi-arrow-left" outcome="boxes" styleClass="ui-button-flat ui-button-plain"
				style="margin-right: 10px;" />
			<h:outputText value="Caixa #{comicBean.currentBox.identifier}" style="font-size: 2rem; font-weight: bold;"
				rendered="#{not empty comicBean.currentBox}" />
			<h:outputText value="Caixa não encontrada" style="font-size: 2rem; font-weight: bold; color: #ff9999;"
				rendered="#{empty comicBean.currentBox}" />
		</h:panelGroup>

		<h:form id="newComicForm" rendered="#{authUser.role == 'ADMIN' and not empty comicBean.currentBox}">
			<p:panel header="Adicionar nova revista" style="margin-bottom: 20px;" toggleable="true" collapsed="true">
				<h:panelGrid columns="3" cellpadding="7">

					<p:outputLabel value="Título:" for="title" />
					<p:inputText id="title" value="#{comicBean.newComic.title}" required="true" requiredMessage="Insira um título" />
					<p:message for="title" />

					<p:outputLabel value="Coleção:" for="collection" />
					<p:inputText id="collection" value="#{comicBean.newComic.collection}" required="true" requiredMessage="Insira a coleção" />
					<p:message for="collection" />

					<p:outputLabel value="Edição:" for="edition" />
					<p:inputText id="edition" value="#{comicBean.newComic.edition}" required="true" 
						requiredMessage="Insira o número da edição" converterMessage="A edição deve ser um número inteiro (ex: 12)." />
					<p:message for="edition" />

					<p:outputLabel value="Ano:" for="year" />
					<p:inputMask id="year" value="#{comicBean.newComic.year}" required="true" mask="9999" requiredMessage="Insira o ano" />
					<p:message for="year" />

					<f:facet name="footer">
						<p:commandButton value="Adicionar Revista" action="#{comicBean.save}" update="@form :comicForm" icon="pi pi-check" />
					</f:facet>

				</h:panelGrid>
			</p:panel>
		</h:form>

		<h:form id="comicForm">

			<h:outputText value="Nenhum quadrinho cadastrado nesta caixa." rendered="#{empty comicBean.allComics}"/>

			<p:dataTable id="tableComics" value="#{comicBean.allComics}" var="comic" paginator="true" rows="5"
				paginatorPosition="bottom" rendered="#{not empty comicBean.allComics}">

				<p:column headerText="Título" sortBy="#{comic.title}">
					<h:outputText value="#{comic.title}" />
				</p:column>

				<p:column headerText="Coleção">
					<h:outputText value="#{comic.collection}" />
				</p:column>

				<p:column headerText="Edição">
					<h:outputText value="#{comic.edition}ª Edição" />
				</p:column>

				<p:column headerText="Ano">
					<h:outputText value="#{comic.year}" />
				</p:column>
				
				<p:column headerText="Status">
					<p:tag value="#{comic.available ? 'Disponível' : 'Emprestado'}"
						severity="#{comic.available ? 'success' : 'warning'}" />
				</p:column>
				

				<p:column headerText="">
					<p:commandButton value="Pedir Emprestado" icon="pi pi-shopping-bag" action="borrow.xhtml?faces-redirect=true"
						rendered="#{authUser.role == 'USER' and comic.available}">
						<f:setPropertyActionListener value="#{comic}" target="#{loanBean.selectedComic}" />
					</p:commandButton>
				</p:column>
				
			</p:dataTable>
		</h:form>
	</ui:define>

</ui:composition>